{% extends 'outerHtml.html'%}
{% block content %}
    {% load leaflet_tags %}
    <!-- Page content -->
    <!-- Title -->
    <div class="w3-display-container w3-content w3-wide" style="max-width:1500px;">
        <h3 class="w3-border-bottom w3-border-light-grey w3-padding-16" id="slopeName"></h3>
    </div>
    <!-- Map -->
    <div class="w3-display-container w3-content w3-wide" style="max-width:1500px; min-height: 600px;" id="slopeForests">
        <!-- Map Section -->
        {% leaflet_map "slopeForests" callback="main_map_init" %}
        <script type="text/javascript">

            // init map at a certain position and zoom
            function main_map_init(map, options) {
                map.setView([46.211657, 7.481341], 14);

                // context keys
                var urls = [
                "{{huts|escapejs }}",
                "{{skiSlope|escapejs }}",
                "{{hotels|escapejs }}",
                "{{restaurants|escapejs }}",
               
            ]
            
            // polygons
         urls.forEach(function (url) {                
                var shapes = JSON.parse(url);
                var type = shapes.features[0].properties.type;
                    var geojsonLayer = L.geoJson(shapes, {
                        style: function (feature) {
                            switch (type) {
                            case"hotel":
                                return { color: 'yellow' };
                            case "restaurant":
                                return { color: 'orange' };
                            case "parking":
                                return { color: 'purple' };
                            case "hut":
                                return { color: 'brown' };
                            case "ski_slope":
                                return { color: 'grey' };
                            }
                            },onEachFeature: onEachFeature,
                        }).addTo(map)
                        geojsonLayer.eachLayer(function(layer){
                        layer.openPopup();
                        });
                    });

                // Set page title
                //document.getElementById("slopeName").textContent = skiSlope.features[0].properties.name
                //+ " et ses " + hotels.features.length + " services"
            }

            function onEachFeature(feature, layer) {
                if (feature.properties) {
                    layer.bindPopup(feature.properties.name, {autoClose:false}).openPopup();
                    //layer.bindPopup(feature.properties.name);
                }
            }

        </script>
    </div>
{% endblock %}