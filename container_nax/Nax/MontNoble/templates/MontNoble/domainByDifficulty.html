{% extends 'outerHtml.html'%}
{% block content %}
    {% load leaflet_tags %}
    <!-- Page content -->
    <!-- Title -->
    <div class="w3-display-container w3-content w3-wide" style="max-width:1500px;">
        <h3 class="w3-border-bottom w3-border-light-grey w3-padding-16" id="slopeName">Votre expérience personnalisée à votre niveau</h3>
    </div>
    <!-- Map -->
    <div class="w3-display-container w3-content w3-wide" style="max-width:1500px; height: 800px" id="slopeForests">
        <!-- Map Section -->
        {% leaflet_map "slopeForests" callback="main_map_init" %}
        <script type="text/javascript">

            // init map at a certain position and zoom
            function main_map_init(map, options) {
                map.setView([46.211657, 7.481341], 14);

                // context keys
                var urls = [
                    "{{huts|escapejs }}",
                    "{{skiSlopes|escapejs }}",
                    "{{hotels|escapejs }}",
                    "{{restaurants|escapejs }}",
                ]

                // polygons
                urls.forEach(function (url) {
                    var shapes = JSON.parse(url);
                    if (shapes.features.length > 0) {
                        var type = shapes.features[0].properties.type;
                        var geojsonLayer = L.geoJson(shapes, {
                            style: function (feature) {
                                switch (type) {
                                    case "hotel":
                                        return { color: 'yellow' };
                                    case "restaurant":
                                        return { color: 'orange' };
                                    case "parking":
                                        return { color: 'purple' };
                                    case "hut":
                                        return { color: 'brown' };
                                    case "ski_slope":
                                        switch (feature.properties.difficulty) {
                                            case 1: return { color: 'green' };
                                            case 2:
                                            case 3: return { color: 'blue' };
                                            case 4: return { color: 'red' };
                                            case 5: return { color: 'black' };
                                        }
                                }
                            }, onEachFeature: onEachFeature,
                        }).addTo(map)
                    }
                });

                var lineUrls = [
                    "{{chairLifts|escapejs }}",
                ];

                lineUrls.forEach(function (url) {
                    var shapes = JSON.parse(url);
                    if (shapes.features.length > 0) {
                        L.geoJson(shapes, {
                            style: function (feature) {
                                return { color: 'red' }; // Modifier le style des lignes selon vos besoins
                            },
                            onEachFeature: onEachFeature,
                        }).addTo(map);
                    };
                });

            } // main map init

            function onEachFeature(feature, layer) {
                if (feature.properties) {
                    var popupContent = "";
                    for (var property in feature.properties) {
                        if (property != "type" && property != "altitude" && property != "available" && property != "protected" && property != "pk") {
                            popupContent += property + ": " + feature.properties[property] + "<br>";
                        } else if (property === "altitude") {
                            popupContent += property + ": " + feature.properties[property] + " m" + "<br>";
                        } else if (property === "available" || property === "protected") {
                            // 1 = true, 0 = false
                            if (feature.properties[property] == 1) {
                                popupContent += property + ": yes" + "<br>";
                            } else if (feature.properties[property] == 0) {
                                popupContent += property + ": no" + "<br>";
                            }
                        }
                    }
                    layer.bindPopup(popupContent);
                }
            }
        </script>
    </div>
{% endblock %}